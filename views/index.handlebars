<div class="index-class">

    <nav>
    <div class="nav-wrapper">
      <a href="#" class="brand-logo"><img class="" id="logoImg" src="assets/images/ourLogo.png" alt=""></a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a class="btn light-green accent-4" id="navButton"href="#!">About Us</a></li>
      </ul>
    </div>
    </nav>

    <div class="container center">
        <div id="firstSection"> 
            <div id="header">
                <h4 class="green-text">Build your business in just one click</h4>
            </div>
        <h5>In to Design can help you to connect your business, <br>
            just pick one design and your brand will be ready to be presented to the world</h5>
        <br>
            <div class="row">
                <div class="col s3 offset-s1 m3 offset-m1">
                    <div class="card">
                        <div class="card-image">
                            <a class="temp1-link">
                                <img src="assets/images/template1.png">
                            </a>
                        </div>
                    </div>
                    <a class="btn grey lighten-2 temp1-link">Template 1</a>
                
                </div>
                <div class="col s3 m3">
                    <div class="card">
                        <div class="card-image">
                            <a class="temp2-link">
                                <img src="assets/images/template2.png">
                            </a>
                        </div>
                    </div>
                        <a class="btn grey lighten-2 temp2-link">Template 2</a>

                </div>
                <div class="col s3 m3">
                    <div class="card">
                        <div class="card-image">
                            <a class="temp3-link">
                                <img src="assets/images/template3.png">
                            </a>
                        </div>
                    </div>
                        <a class="btn grey lighten-2 temp1-link">Template 3</a>
                </div>
            </div>
        </div>
    </div>
        <div id="secondSection">
            <h5>It gets easier! ... <br>
                If your company is on YELP just click on Yelp Users and most of the information will be Ô¨Ålled out for you!</h5>

        <a class="waves-effect waves-light btn light-green accent-4" id="yelpBtn">Yelp Users</a>
        <a class="waves-effect waves-light btn light-green accent-4" id="nonYelpBtn">Non Yelp Users</a>
        </div>

    <div class="row" id="businessInput">
        <form class="col s12">
            <div class="row">
                <div class="input-field col s6">
                    <input id="business_name" type="text" class="validate">
                    <label for="business_name">Business Name</label>
                </div>
                <div class="input-field col s6">
                    <input id="business_location" type="text" class="validate">
                    <label for="business_location">Location</label>
                </div>
            </div>
            <a class="waves-effect waves-light btn modal-trigger" id="searchYelp" href="#modal1">Search</a>
            <a class="waves-effect waves-light btn home">Home</a>
    </div>

    <div class="row" id="businessForm">
        <form class="col s12">
            <div class="row">
                <div class="input-field col s6">
                    <input id="business_name" type="text" class="validate">
                    <label for="business_name">Business Name</label>
                </div>
                <div class="input-field col s6">
                    <input id="business_phone" type="text" class="validate">
                    <label for="business_phone">Phone Number</label>
                </div>
            </div>
            <button class="btn waves-effect waves-light" type="submit" name="action">Submit
                <i class="material-icons right"></i>
            </button>
            <a class="waves-effect waves-light btn home">Home</a>
    </div>

    <!-- Modal Structure -->
    <div id="modal1" class="modal">
        <div class="modal-content">
            <h4>List of Business</h4>
            <div class="collection">
                <ul id="modal-info">

                </ul>


            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-green btn-flat">Agree</a>
        </div>
    </div>

    

</div>

<script>

    $(document).ready(function () {
        
        $("#businessInput").hide();
        $("#businessForm").hide();


        $("#yelpBtn").on("click", function () {
            $("#yelpBtn").hide();
            $("#businessInput").show();
            $("#nonYelpBtn").hide();
        })

        $("#nonYelpBtn").on("click", function () {
            $("#nonYelpBtn").hide();
            $("#yelpBtn").hide();
            $("#businessForm").show();
        })

        $(".home").on("click", function () {
            $("#yelpBtn").show();
            $("#nonYelpBtn").show();
            $("#businessInput").hide();
            $("#businessForm").hide();
        })

        $("#searchYelp").on("click", function () {
            event.preventDefault();
            $("#modal-info").empty();
            
            var newBusiness = $("#business_name").val().trim();
            var city = $("#business_location").val().trim();
            console.log(newBusiness, city);
            var query = "/api/yelp/" + newBusiness + "/" + city;
            console.log(query);
            
            $.ajax(query, {
                type: "GET"
            }).then(function (data) {


                var businessArr = [];
                for (var i = 0; i < data.length; i++) {
                    var business = {
                        name: data[i].name,
                        address: data[i].location.display_address,
                        id: data[i].id
                    };

                    businessArr.push(business);
                };

                for (var i = 0; i < businessArr.length; i++) {
                    var li = $("<li>");
                    var button = $('<a href="#!" class="secondary-content select-business"><i class="far fa-hand-pointer"></i></a>');
                    li.text(businessArr[i].name + " " + businessArr[i].address);
                    button.attr("data-id", businessArr[i].id);

                    li.append(button);
                    $("#modal-info").append(li);
                };

                $('.modal').modal();
                $('#modal1').modal('open');
            }
            );
        });

        var idToLink;
        $(".modal").on("click", ".select-business", function (event) {
            var id = $(this).data("id");
            console.log("id from front end",id);
            var query = "/api/yelp/" + id;
            console.log("query segundo get",query);

            $.ajax(query, {
                type: "GET"                    
            }).then(function(data) {
                
                
                var dataObject = JSON.parse(data);
                console.log(dataObject);


                var query2 = "/api/addBusiness";
                $.post(query2, dataObject).then (function(moreData) {                    
                    idToLink = moreData.id;
                    $(".temp1-link").attr("href","/template1/"+idToLink);
                    $(".temp2-link").attr("href","/template2/"+idToLink);
                    $(".temp3-link").attr("href","/template3/"+idToLink);

                    $('#modal1').modal('close');

                    console.log("MoreData", idToLink);
                });
                
                
            });

        });

        

    });

</script>